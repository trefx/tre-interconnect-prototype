#
# Copyright (c) 2023, Arjuna Technologies Limited, Newcastle upon Tyne, Tyne and Wear, UK.
#

apiVersion: v1
kind: Pod
metadata:
  name: demo-lab
spec:
  containers:
  - name: activemq
    image: quay.io/artemiscloud/activemq-artemis-broker-kubernetes:latest
    ports:
    - containerPort: 8161
      hostPort: 8261
    - containerPort: 5672
      hostPort: 5772
    env:
      - name: AMQ_USER
        value: "admin"
      - name: AMQ_PASSWORD
        value: "password"
  - name: mongo
    image: docker.io/library/mongo:latest
    volumeMounts:
      - mountPath: /data/db
        name: mongo-data
    env:
      - name: MONGO_INITDB_ROOT_USERNAME
        value: "admin"
      - name: MONGO_INITDB_ROOT_PASSWORD
        value: "password"
  - name: minio
    image: quay.io/minio/minio
    volumeMounts:
      - mountPath: /data
        name: minio-data
    ports:
    - containerPort: 9001
      hostPort: 9101
    env:
      - name: MINIO_ROOT_USER
        value: "admin"
      - name: MINIO_ROOT_PASSWORD
        value: "password"
    args: ["server", "/data", "--address", ":9000", "--console-address", ":9001"]
  - name: webportal
    image: docker.io/risbic/lab-webportal:gt
    ports:
    - containerPort: 80
      hostPort: 8180
    env:
      - name: NGINX_HOST
        value: "localhost"
      - name: NGINX_PORT
        value: "80"
  - name: request_creator
    image: docker.io/risbic/lab-request-creator:gt
  - name: response_processor
    image: docker.io/risbic/lab-response-processor:gt
  - name: request_sender
    image: docker.io/risbic/lab-request-sender:gt
  - name: devel
    image: docker.io/risbic/lab-devel:gt
    volumeMounts:
      - mountPath: /data
        name: devel-data
  volumes:
    - name: devel-data
      hostPath:
        path: ./devel-data/lab
        type: DirectoryOrCreate
    - name: mongo-data
      hostPath:
        path: ./lab-data/mongo
        type: DirectoryOrCreate
    - name: minio-data
      hostPath:
        path: ./lab-data/minio
        type: DirectoryOrCreate
